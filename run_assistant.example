#!/bin/bash

# pull latest tag
docker pull registry.cn-beijing.aliyuncs.com/llaoj/harbor-assistant

# run assistant:
# required by docker-compose
#   -v /var/run/docker.sock:/var/run/docker.sock
# required by modprobe to add kernel module
#   -v /lib/modules:/lib/modules
docker run \
    --name harbor-failover \
    --cap-add=NET_ADMIN \
    --cap-add=NET_BROADCAST \
    --cap-add=NET_RAW \
    --cap-add=SYS_ADMIN \
    --net=host \
    --pid=host \
    --privileged \
    --security-opt seccomp=unconfined \
    -e CEPH_MON_HOST='<host1,host2,host3>' \
    -e CEPH_USER='<ceph-user>' \
    -e CEPH_USER_KEY='<ceph-user-key>' \
    -e CEPH_POOL_NAME='<ceph-pool-name>' \
    -e CEPH_IMAGE_NAME='<ceph-image-name>' \
    -e KEEPALIVED_VIP='<keepalived-vip>' \
    -e KEEPALIVED_ROLE='<keepalived-role>' \
    -e INTERFACE='<interface>' \
    -v /var/run/docker.sock:/var/run/docker.sock \
    -v /dev:/dev \
    -v /proc/modules:/proc/modules \
    -v /run/mount:/run/mount \
    -v /lib/modules:/lib/modules \
    -v /sys/module:/sys/module \
    -v /etc/selinux:/etc/selinux \
    -v /mnt:/mnt \
    registry.cn-beijing.aliyuncs.com/llaoj/harbor-assistant
